<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.audiro.repository.TravelPlanDao">

<insert id="insertTravelPlan" 
	parameterType="TravelPlan"
	keyProperty="plan.travelPlanId" 
	keyColumn="travel_plan_id"
	useGeneratedKeys="true">
	insert into travel_plan (users_id, title, start_date, duration, end_date)
	values (#{plan.usersId}, #{plan.title}, #{plan.startDate}, #{plan.duration}, #{plan.endDate})
</insert>

<insert id="insertDetailedPlan">
	insert 
	into detailed_plan 
		(travel_plan_id, destination_id, day, start_time, end_time)
	values 
		(#{travelPlanId}, #{destinationId}, #{day}, #{startTime}, #{endTime})

</insert>

	<select id="selectAllTrvaelPlan" resultType="TravelPlan">
		select * from
		travel_plan order by travel_plan_id
	</select>

	<select id="selectTravelPlanById" resultType="TravelPlan">
		select * from travel_plan
		where travel_plan_id = #{travel_plan_id}
	</select>

	<select id="selectDetailedPlan" resultType="DetailedPlanDto">
		select d.*, t.name, t.img_url, f.favorite_destination_id 
		from detailed_plan d
		join travel_destination t
		on d.destination_id = t.travel_destination_id
		join favorite_destination f
   		on t.travel_destination_id = f.destination_id
		where travel_plan_id = #{travel_plan_id}
		order by detailed_plan_id
	</select>
	
	<select id="selectMaxDay"  resultType="Integer">
		select max(day) from detailed_plan where travel_plan_id = #{travel_plan_id}
	</select>

</mapper>
